@using SIS_Ga2.Entity
@using SIS_Ga2.Controllers

@model IEnumerable<SIS_Ga2.Entity.Proyecto>
@{
    //Layout = null;

    ViewBag.Title = "Diseno";
    BEUsuario usuario = Session["sistema.usuario"] as BEUsuario;
    Proyecto GetProyecto = Session["sistema.proyecto"] as Proyecto;
    Sistema sistema = Session["sistema.general"] as Sistema;
    if (sistema == null)
    {
        Response.Redirect(Url.Action("Login", "Seguridad"));
        return;
    }
}


<div class="col-lg-12">
    <div class="card">
        <div class="card-header d-flex align-items-center">
            <div class="form-group col-md-3">
                <h3 class="h5">Registro de Proyectos</h3>
            </div>
        </div>
        <div class="card-body">
            <nav class="nav nav-pills nav-justified nav-tabs">
                <a class="nav-item nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Proyecto</a>
                <a class="nav-item nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Diseño</a>
                <a class="nav-item nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Parámetros</a>
            </nav>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                    @using (Html.BeginForm("FormRegistraProyecto", "ProyectoDiseno", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {

                        <form>
                            <div class="row">
                                <div class="form-group col-md-5">
                                    <label for="inlineFormInput" class="col-form-label col-form-label-sm">Nombre del Proyecto</label>
                                    <input id="txtNombProyecto" name="txtNombProyecto" data-id="1" type="text" placeholder="Nombre del Proyecto" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="inlineFormInput" class="col-form-label col-form-label-sm">Fecha de Proyecto</label>
                                    <input id="datetimepicker1" name="datetimepicker1" type="text" placeholder="Fecha de Proyecto" class="mr-3 col-sm-12 form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="inlineFormInput" class="col-form-label col-form-label-sm">Fecha Contrato</label>
                                    <input id="datetimepicker2" name="datetimepicker2" type="text" placeholder="Fecha Contrato" class="mr-3 col-sm-12 form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="inlineFormInput" class="col-form-label col-form-label-sm">Ingeniero</label>
                                    <input id="txtIngeniero" name="txtIngeniero" data-id="4" type="text" placeholder="Ingeniero" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                </div>
                            </div>

                            <div class="card-header">
                                <div class=" clearfix">
                                    <div class="p-0">
                                        <div class="btn-group float-left" role="group" aria-label="Basic example">
                                        </div>
                                    </div>
                                    <div class="p-0">
                                        <div class="btn-group float-right" role="group" aria-label="Basic example">
                                            <button type="submit" id="btnSiguiente_a" class="btn btn-primary"><span class="icon-page"></span> Siguiente</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    }
                </div>
                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <form class="form-inline">
                        <div class="row">
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Tipo de Diseño</label>
                                <input id="txtTipodiseno" data-id="1" type="text" placeholder="Tipo de Diseño" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Diseño</label>
                                <input id="txtDiseno" type="text" placeholder="Diseño" class="mr-3 col-sm-12 form-control form-control-sm">
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Tramo</label>
                                <input id="txtTramo" type="text" placeholder="Tramo" class="mr-3 col-sm-12 form-control form-control-sm">
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Reglamento</label>
                                <input id="txtReglamento" data-id="4" type="text" placeholder="Reglamento" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Departamento</label>
                                @Html.DropDownList("ddlDepartamento", null, new { @class = "mr-3 col-sm-12 form-control form-control-sm" })
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Provincia</label>
                                @Html.DropDownList("ddlProvincia", null, new { @class = "mr-3  col-sm-12 form-control form-control-sm" })
                            </div>
                            <div class="form-group col-md-5">
                                <label for="inlineFormInput" class="col-form-label col-form-label-sm">Distrito</label>
                                @Html.DropDownList("ddlDistrito", null, new { @class = "mr-3  col-sm-12 form-control form-control-sm" })
                            </div>
                        </div>
                    </form>
                    <div class="card-header">
                        <div class=" clearfix">
                            <div class="p-0">
                                <div class="btn-group float-left" role="group" aria-label="Basic example">
                                </div>
                            </div>
                            <div class="p-0">
                                <div class="btn-group float-right" role="group" aria-label="Basic example">
                                    <button type="button" id="btnSiguiente_b" class="btn btn-primary"><span class="icon-page"></span> Siguiente</button>
                                </div>
                                <div class="btn-group float-right" role="group" aria-label="Basic example">
                                    &nbsp;
                                </div>
                                <div class="btn-group float-right" role="group" aria-label="Basic example">
                                    <button type="button" id="btnCancelar_b" class="btn btn-secondary"><span class="icon-page"></span> Cancelar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item active" aria-current="page">Datos de Parámetro de Diseño</li>
                        </ol>
                    </nav>

                    <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="Proy-tab" data-toggle="tab" href="#Proy" role="tab" aria-controls="Proy" aria-selected="true">Parámetros de Diseño</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="Cap-tab" data-toggle="tab" href="#Cap" role="tab" aria-controls="Cap" aria-selected="false">Capas de Pavimento</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="Param-tab" data-toggle="tab" href="#Param" role="tab" aria-controls="Param" aria-selected="false">Coeficientes</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContents">
                        <div class="tab-pane fade show active" id="Proy" role="tabpanel" aria-labelledby="Proy-tab">
                            <form class="form-inline">
                                <div class="row">
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Periodo de Diseño</label>
                                        <input id="txtPeriodoDiseno" data-id="1" type="text" placeholder="Periodo de Diseño" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Cantidad de ESAL</label>
                                        <input id="txtCantidadESAL" type="text" placeholder="Cantidad de ESAL" class="mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Confiabilidad (R%)</label>
                                        <input id="txtConfiab" type="text" placeholder="Confiabilidad (R%)" class="mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Error de Comb.Estándar (SO)</label>
                                        <input id="txtErrorComb" data-id="4" type="text" placeholder="Error de Comb.Estándar (SO)" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Módulo de Resilencia (Subrasante)</label>
                                        <input id="txtModResilencia" data-id="1" type="text" placeholder="Módulo de Resilencia (Subrasante)" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Servicialidad Inicial</label>
                                        <input id="txtServInicial" type="text" placeholder="Servicialidad Inicial" class="mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Servicialidad Final</label>
                                        <input id="txtServFinal" type="text" placeholder="Servicialidad Final" class="mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Diferencia de Servicialidad (∆PSI)</label>
                                        <input id="txtDifServ" data-id="4" type="text" placeholder="Diferencia de Servicialidad (∆PSI)" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="inlineFormInput" class="col-form-label col-form-label-sm">Desviación Estándar Normal (ZR)</label>
                                        <input id="txtDesvEstandar" data-id="4" type="text" placeholder="Desviación Estándar Normal (ZR)" class="column_filter mr-3 col-sm-12 form-control form-control-sm">
                                    </div>
                                </div>
                            </form>
                            <div class="card-header">
                                <div class=" clearfix">
                                    <div class="p-0">
                                        <div class="btn-group float-left" role="group" aria-label="Basic example">
                                        </div>
                                    </div>
                                    <div class="p-0">
                                        <div class="btn-group float-right" role="group" aria-label="Basic example">
                                            <button type="button" id="btnSiguiente_c" class="btn btn-primary"><span class="icon-page"></span> Siguiente</button>
                                        </div>
                                        <div class="btn-group float-right" role="group" aria-label="Basic example">
                                            &nbsp;
                                        </div>
                                        <div class="btn-group float-right" role="group" aria-label="Basic example">
                                            <button type="button" id="btnCancelar_c" class="btn btn-secondary"><span class="icon-page"></span> Cancelar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="Cap" role="tabpanel" aria-labelledby="Cap-tab">En construcción...</div>
                        <div class="tab-pane fade" id="Param" role="tabpanel" aria-labelledby="Param-tab">En construcción...</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="~/Scripts/jquery-3.3.1.js"></script>
<script type="text/javascript">

    $(document).ready(function () {

        $("#ddlDepartamento").change(function () {
            cambiaDepartamento($("#ddlDepartamento").val());
            //var id = $(this).val();
            //var text = $(this).find('option:selected').text();
            //alert(text);
        });

        $("#ddlProvincia").change(function () {
            cambiaProvincia($("#ddlProvincia").val());
        });

        cambiaDepartamento($("#ddlDepartamento").val());

    });

    function cambiaDepartamento(idDepartamento) {

        // var dd2 = document.getElementById("idIngeniero");
        //alert(dd2.value);
        var dd = document.getElementById("ddlProvincia");

        dd.options.length = 0;
        dd.options[0] = new Option("Espere...");
        dd.selectedIndex = 0;
        dd.disabled = true;

        // Control de errores
        $("#ddlProvincia").ajaxError(function (event, request, settings) {
            dd.options[0] = new Option("Departamento incorrecto");
        });


        var objData = {};
        objData["idDepartamento"] = idDepartamento;

        $.ajax({
            type: "POST",
            url: '/Home/ListaProvincias',
            data: JSON.stringify(objData),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (provincias) {

                var obj = (typeof provincias) == 'string' ? eval('(' + provincias + ')') : provincias;

                $.each(obj, function (i, item) {

                    dd.options[i] = new Option(item.Provincia, item.Id_Provincia);

                });

                dd.disabled = false;
                cambiaProvincia($("#ddlProvincia").val());
            }

        });
    }

    function cambiaProvincia(idProvincia) {

        var dd = document.getElementById("ddlDistrito");

        dd.options.length = 0;
        dd.options[0] = new Option("Espere...");
        dd.selectedIndex = 0;
        dd.disabled = true;

        // Control de errores
        $("#ddlDistrito").ajaxError(function (event, request, settings) {
            dd.options[0] = new Option("Distrito incorrecto");
        });


        var objData = {};
        objData["idProvincia"] = idProvincia;

        $.ajax({
            type: "POST",
            url: '/Home/ListaDistritos',
            data: JSON.stringify(objData),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (distritos) {

                var obj = (typeof distritos) == 'string' ? eval('(' + distritos + ')') : distritos;

                $.each(obj, function (i, item) {

                    dd.options[i] = new Option(item.Distrito, item.id_Distrito);

                });

                dd.disabled = false;

            }

        });

    }




</script>

